# Product Forging Guide

### Make a virtual envirnoment if not already present by using the following snippet

```
    pip install virtualenv
    python -m virtualenv sales_salt

    #for activating env

    ./sales_salt/Scripts/activate

    #start a django project

    python -m django startproject <<projectName>>

```

After sucessful project creation the following rituals should be followed

## n_app settings


   - Make database configuration in the following format for required default and slaves


   ```
    [client]
    database = app_name
    user = shivam
    password = Frooti30
    default-character-set = utf8
   ```


   1. Patch settings.py

    - SuperBase Addition + lib import
  

    ```
    import os
    SUPER_BASE = Path(__file__).resolve().parent.parent.parent
    STORE = os.path.join(SUPER_BASE, 'store')
    UNIVERSE = os.path.join(SUPER_BASE, 'store', 'django_store', 'libs', 'universe', 'n_app_factory')

    #intended for assciating products route

    #----Database---#

    DATABASES = {
            'default': {
                'ENGINE': 'django.db.backends.mysql',
                'OPTIONS':{
                    'read_default_file':os.path.join(STORE, 'conf', app_name, 'db', 'mysql.conf')
                }
            },

            'slave0':{
            
                'ENGINE': 'django.db.backends.mysql',
                'OPTIONS':{
                    'read_default_file':os.path.join(STORE, 'conf', app_name, 'db', 'slave0.conf')
                }
            },

            'slave1':{
            
                'ENGINE': 'django.db.backends.mysql',
                'OPTIONS':{
                    'read_default_file':os.path.join(STORE, 'conf', app_name, 'db', 'slave1.conf')
                }
            }

        }


    REPLICATED_DATABASE_SLAVES = ['slave0', 'slave1']





    
    #---MIDDLEWARE----#
    # add below above csrf in middleware
    #'n_app_factory.middleware.nameBasedBlocking',
    
    
    #---- AT FILE END -- #
    #n_app settings

    SSO_SUBORDINATE_COMMUNICATION_TIMEOUT = 10
    APP_SUBLEVELS = ['CustomerLevel', 'ApplicationLevel', 'OperationLevel']
    CICD_STAGE = "DEV"
    #[DEV, STAGE, BETA, PROD]
    APP_NAMES = []
    MODELS_DENIED = {}


    ```

   2. Stage_Load/Specific_Load
    
    - Create stage_load.py in project root 
    - Append the following code

    ```
    from django.conf import settings
    import sys
    sys.path += [str(settings.SUPER_BASE), str(settings.STORE), str(settings.UNIVERSE)]
    from store.django_store.libs.universe.n_app_factory.actions import load_package

    #supper base added to route
    #Should only be used for import of standard libs and sdks


    stages = {
                "DEV":{"packages":[],
                        "exclude_nested":[],
                        "template_apps":['n_app_factory',
                                        'allauth', 
                                        'allauth.account', 
                                        'allauth.socialaccount',
                                        'django_db_logger',
                                        'django_sso.sso_service']
                        "models_denied":{}},
                
                "STAGE":{"packages":[],
                        "exclude_nested":[],
                        "models_denied":{}},
                
                "BETA":{"packages":[],
                        "exclude_nested":[],
                        "models_denied":{}},
                        
                "PROD":{"packages":[],
                        "exclude_nested":[],
                        "models_denied":{}}
            }


    load_package(stages)


    ```

   4. go to projects __init__.py append the code

    ```
    import accounts.stage_load
    ```



## SSO Configuration

    1. OPEN settings.py and append the follwing code

    ```
        

     with open(os.path.join(SUPER_BASE, 'conf', 'servers', 'server.json'), 'r') as f:

         SERVER = json.load(f)


     LOGIN_URL = SERVER['auth']['auth_sso_login_url'] 
     SSO_ROOT = SERVER['auth']['auth_sso_server_address']
     SSO_TOKEN = 'secret_token generated by subordinate service'
     SESSION_COOKIE_NAME = 'unique cookie name'

 ```

## allAuth settings

 1. Open settings.py and append

    ```
     # config/settings.py
    EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

    AUTHENTICATION_BACKENDS = (
    # Needed to login by username in Django admin, regardless of `allauth`
    "django.contrib.auth.backends.ModelBackend",

    # `allauth` specific authentication methods, such as login by e-mail
    "allauth.account.auth_backends.AuthenticationBackend",
    )



    REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10
    }

    ACCOUNT_EMAIL_REQUIRED = True
    ACCOUNT_USERNAME_REQUIRED = False
    ACCOUNT_SIGNUP_PASSWORD_ENTER_TWICE = False
    ACCOUNT_SESSION_REMEMBER = True
    ACCOUNT_AUTHENTICATION_METHOD = 'email'
    ACCOUNT_UNIQUE_EMAIL = True

    ```

